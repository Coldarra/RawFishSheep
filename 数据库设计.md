## 数据库设计文档
 
<font style="background:#ffeeba">
    warning: 价格单位：分（integer）
</font>

#### 用户表 app:app_user table:Userinfo
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|username|用户名|varchar(30)||
|password|密码|varchar(100)||
|gender|性别|varchar(30)||
|phonenumber|手机号|varchar(30)||
|email|邮箱|varchar(50)|非必填|
|level|用户等级|varchar(30)|默认值user|
|about|关于|varchar(200)||
|headid|头像|integer|默认值0|
|registerdate|注册时间|datetime||
|isdetele|是否删除|varchar(1)||

~~~python
class User(models.Model):
    username = models.CharField(max_length=30, unique=True, verbose_name='用户名')
    password = models.CharField(max_length=100, verbose_name='密码')
    gender = models.CharField(
        max_length=30, verbose_name='性别')
    phonenumber = models.CharField(
        max_length=30, unique=True, verbose_name='手机号')
    email = models.CharField(blank=True, null=True,
                             max_length=50, verbose_name='邮箱')
    level = models.CharField(
        default='user', max_length=20, verbose_name='用户等级')
    about = models.CharField(blank=True, null=True,
                             max_length=200, verbose_name='关于')
    headid = models.IntegerField(
        blank=True, null=True, default=0, verbose_name='头像')
    registerdate = models.DateTimeField(
        verbose_name='注册时间')

    def __str__(self):
        return "{} {} {} {}".format(self.username, self.phonenumber, self.email, self.level)

    class Meta:
        db_table = 'Userinfo'
        verbose_name = 'RawFishSheep'
        app_label = 'app_user'
~~~


#### 地址表 app:app_user table:User_address
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|user|用户|userinfo|ForeignKey|
|address|详细地址|varchar(100)||
|status|地址状态|varchar(1)||
~~~python
class Address(models.Model):
    user = models.ForeignKey(User, null=True, blank=True,         on_delete=models.SET_NULL, related_name='address_by_user')
    address = models.CharField(max_length=100, verbose_name='详细地址')
    status = models.CharField(max_length=1, verbose_name='地址状态')

    def __str__(self):
        return "{} {} {}".format(self.user, self.address, self.status)

    class Meta:
        db_table = 'User_address'
        verbose_name = 'RawFishSheep'
        app_label = 'app_user'
~~~

#### 订单表 app:app_order table:Order
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|user|用户|userinfo|ForeignKey|
|address|地址|address|ForeignKey|
|totalprice|订单总价|integer||
|discount|优惠价格|integer||
|createtime|下单时间|datetime||
|finishtime|完成时间|datetime||
|isdetele|是否删除|varchar(1)||
|isrefund|是否完成退款|varchar(1)||

~~~python
class Order(models.Model):
    user = models.ForeignKey(User, null=True, blank=True, on_delete=models.SET_NULL, related_name='orders_by_user')
    address = models.ForeignKey(Address, null=True, blank=True, on_delete=models.SET_NULL,related_name='orders_by_address')
    totalprice = models.IntegerField(blank=True, null=True, default=0, verbose_name='订单总价')
    discount = models.IntegerField(blank=True, null=True, default=0, verbose_name='优惠价格')
    createtime = models.DateTimeField(verbose_name = '下单时间')
    finishtime = models.DateTimeField(verbose_name = '完成时间')
    isdetele = models.CharField(max_length=1, verbose_name='是否删除')
    isrefund = models.CharField(max_length=1, verbose_name='是否完成退款')
    
    def __str__(self):
        return "{} {} {} {} {} {} {} {}".format(self.user, self.address, self.totalprice, self.discount, self.createtime, self.finishtime, self.isdetele, self.isrefund)

    class Meta:
        db_table = 'Order'
        verbose_name = 'RawFishSheep'
        app_label = 'app_order'
~~~

#### 订单详情表 app:app_order talbe:Order_detail
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|order|订单|order|ForeignKey|
|goods|商品|goods|ForeignKey|
|pirce|价格|integer|写死|
|isdetele|是否删除|varchar(1)||

~~~python
class Dtatil(models.Model):
    order = models.ForeignKey(Order, null=True, blank=True, on_delete=models.SET_NULL, related_name='detail_by_order')
    goods = models.ForeignKey(Goods, null=True, blank=True, on_delete=models.SET_NULL, related_name='detail_by_goods')
    price = models.IntegerField(blank=True, null=True, default=0, verbose_name='价格')
    isdetele = models.CharField(max_length=1, verbose_name='是否删除')

    def __str__(self):
        return "{} {} {} {}".format(self.order, self.goods, self.price, self.isdetele)

    class Meta:
        db_table = 'Order_detail'
        verbose_name = 'RawFishSheep'
        app_label = 'app_order'
~~~

#### 购物车表 app:app_order talbe:Order_car
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|user|用户|userinfo|ForeignKey|
|goods|商品|goods|ForeignKey|
|amount|数量|integer||
|pirce|价格|integer|放入购物车时的价格，写死|
|ischoice|是否被选择|varchar(1)||

~~~python
class Car(models.Model):
    user = models.ForeignKey(User, null=True, blank=True, on_delete=models.SET_NULL, related_name='car_by_user')
    goods = models.ForeignKey(Goods, null=True, blank=True, on_delete=models.SET_NULL, related_name='car_by_goods')
    amount = models.IntegerField(blank=True, null=True, default=0, verbose_name='数量')
    price = models,IntegerField(blank=True, null=True, default=0, verbose_name='价格')
    ischoice = models.CharField(max_length=1, verbose_name='是否被选择')
    def __str__(self):
        return "{} {} {} {} {}".format(self.user, self.goods, self.amount, self.price, self.ischoice)

    class Meta:
        db_table = 'Order_car'
        verbose_name = 'RawFishSheep'
        app_label = 'app_order'    
~~~

#### 配送表 app:app_order table:Order_delivery
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|order|订单|order|ForeignKey|
|user|配送员|userinfo|ForeignKey|
|createtime|配送单创建时间|datetime|配送员接到订单的时间|
|receivetime|接货时间|datetime|配送员拿到货物的时间|
|finishtime|送达时间|datetime|配送员送达的时间|
|isdetele|是否删除|varchar(1)||

~~~python
class Delivery(models.Model):
    order = models.ForeignKey(Order, null=True, blank=True, on_delete=models.SET_NULL, related_name='delivery_by_order')
    user = models.ForeignKey(User, null=True, blank=True, on_delete=models.SET_NULL, related_name='delivery_by_user')
    createtime = models.DateTimeField(verbose_name='配送单创建时间')
    receivetime = models.DateTimeField(verbose_name='接货时间')
    finishtime = models.DateTimeField(verbose_name='送达时间')
    isdetele = models.CharField(max_length=1, verbose_name='是否删除')

    def __str__(self):
        return "{} {} {} {} {} {} {}".format(self.order, self.user, self.createtime, self.receivetime, self.finishtime, self.isdetele)

    class Meta:
        db_table = 'Order_delivery'
        verbose_name = 'RawFishSheep'
        app_label = 'app_order'
~~~

#### 仓库表 app:app_warehouse table:Warehouse
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|address|仓库地址|varchar(300)||

~~~python
class Warehouse(models.Model):
    address = models.CharField(max_length=300, verbose_name='仓库地址')

    def __str__(self):
        return "{}".format(self.address)

    class Meta:
        db_table = 'Warehouse'
        verbose_name = 'RawFishSheep'
        app_label = 'app_warehouse'
~~~

#### 进货表 app:app_warehouse table:Warehouse_cargoin
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|goods|商品|goods|ForeignKey|
|warehouse|仓库|warehouse|ForeignKey|
|amount|进货量|integer||
|cost|进货成本|integer||
|entrytime|入库时间|datetime||
|staletime|过期时间|datetime||
|isdetele|是否删除|varchar(1)||

~~~python
class Cargoin(models.Model):
    goods = models.ForeignKey(Goods, null=True, blank=True, on_delete=models.SET_NULL, related_name='cargoin_by_goods')
    warehouse = models.ForeignKey(Warehouse, null=True, blank=True, on_delete=models.SET_NULL, related_name='cargoin_by_warehouse')
    amount = models.IntegerField(blank=True, null=True, verbose_name='进货量')
    cost = models.IntegerField(blank=True, null=True, verbose_name='进货成本')
    entrytime = models.DateTimeField(verbose_name='入库时间')
    staletime = models.DateTimeField(verbose_name='保存时间')
    isdetele = models.CharField(max_length=1, verbose_name='是否删除')

    def __str__(self):
        return "{} {} {} {} {} {} {}".format(self.goods, self.warehouse, self.amount, self.cost, self.entrytime, self.staletime, self.isdetele)

    class Meta:
        db_table = 'Warehous_cargoin'
        verbose_name = 'RawFishSheep'
        app_label = 'app_warehouse'

~~~

#### 出货表 app:app_warehouse table:Warehous_cargoout
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|goods|商品|goods|ForeignKey|
|warehouse|仓库|warehouse|ForeignKey|
|order|订单|order|ForeignKey|
|amount|出货量|integer||
|starttime|出库时间|datetime||
|isdetele|是否删除|varchar(1)||

~~~python
class Cargoout(models.Model):
    goods = models.ForeignKey(Goods, null=True, blank=True, on_delete=models.SET_NULL, related_name='cargoout_by_goods')
    warehouse = models.ForeignKey(Warehouse, null=True, blank=True, on_delete=models.SET_NULL, related_name='cargoout_by_warehouse')
    order = models.ForeignKey(Order, null=True, blank=True, on_delete=models.SET_NULL, related_name='cargoout_by_order')
    amount = models.IntegerField(blank=True, null=True, verbose_name='出货量')
    starttime = models.DateTimeField(verbose_name='出库时间')
    isdetele = models.CharField(max_length=1, verbose_name='是否删除')

    def __str__(self):
        return "{} {} {} {} {} {}".format(self.goods, self.warehouse, self.order, self.amount, self.starttime, self.isdetele)

    class Meta:
        db_table = 'Warehous_cargoout'
        verbose_name = 'RawFishSheep'
        app_label = 'app_warehouse'
~~~

#### 商品表 app:app_goods table:Goods
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|category|商品分类|category|ForeignKey|
|name|商品名称|varchar(100)||
|unit|商品单位|varchar(10)|默认值"个"|
|status|商品状态|varchar(1)||
|isdetele|是否删除|varchar(1)||
|price|当前价格|integer|默认值-1|
|remain|余量|integer|默认值0|

~~~python
class Goods(models.Model):
    category = models.ForeignKey(Category, null=True, blank=True, on_delete=models.SET_NULL, related_name='goods_by_Category')
    name = models.CharField(max_length=100, verbose_name='商品名称')
    unit = models.CharField(default='ge', max_length=10, verbose_name='商品单位')
    status = models.CharField(max_length=1, verbose_name='商品状态')
    isdetele = models.CharField(max_length=1, verbose_name='是否删除')
    price = models.IntegerField(default = -1, blank=True, null=True, default=0, verbose_name='当前价格')
    remain = models.IntegerField(default = 0, blank=True, null=True, default=0, verbose_name='余量')

    def __str__(self)
        return "{} {} {} {} {} {} {}".format(self.category, self.name, self.unit, self.status, self.isdetele, self.price, self.remain)

    class Meta:
        db_table = 'Goods'
        verbose_name = 'RawFishSheep'
        app_label = 'app_goods'
~~~

#### 商品图片表 app:app_goods table:Goods_picture
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|goods|所属商品|goods|ForeignKey|
|path|图片地址|varchar(100)||
|isdetele|是否删除|varchar(1)||

~~~python
class Picture(models.Model):
    goods = models.ForeignKey(Goods, null=True, blank=True, on_delete=models.SET_NULL, related_name='picture_by_goods')
    path = models.CharField(max_length=100, verbose_name='图片地址')
    isdetele = models.CharField(max_length=1, verbose_name='是否删除')

    def __str__(self)
        return "{} {} {}".format(self.goods, self.path, self.isdetele)

    class Meta:
        db_table = 'Goods_picture'
        verbose_name = 'RawFishSheep'
        app_label = 'app_goods'
~~~

#### 商品分类表 app:app_goods table:Goods_category
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|superior|上级分类|category|ForeignKey, 默认值0|
|name|类别名|varchar(50)||
|isdetele|是否删除|varchar(1)||
|level|等级|integer|默认值1|

~~~python
class Category(models.Model):
    superior = models.ForeignKey(Category, null=True, blank=True, default=0,on_delete=models.SET_NULL, related_name='category_by_superior')
    name = models.CharField(max_length=50, verbose_name='类别名')
    isdetele = models.CharField(max_length=1, verbose_name='是否删除')
    level = models.IntegerField(default = 1, blank=True, null=True, default=0, verbose_name='等级')

    def __str__(self)
        return "{} {} {} {}".format(self.superior, self.name, self.isdetele, self.level)

    class Meta:
        db_table = 'Goods_category'
        verbose_name = 'RawFishSheep'
        app_label = 'app_goods'
~~~

#### 商品历史价格表 app:app_goods table:Goods_history
|字段名|字段含义|字段类型|备注|
|:--|:--|:--|:--|
|id||||
|goods|商品|goods|ForeignKey|
|updatetime|定价时间|datetime||
|price|定价|integer||

~~~python
class History(models.Model)
    goods = models.ForeignKey(Goods, null=True, blank=True, on_delete=models.SET_NULL, related_name='history_by_goods')
    updatetime = models.DateTimeField(verbose_name='定价时间')
    price = models.IntegerField(blank=True, null=True, default=0, verbose_name='定价')

    def __str__(self)
        return "{} {} {}".format(self.goods, self.updatetime, self.price)

    class Meta:
        db_table = 'Goods_history'
        verbose_name = 'RawFishSheep'
        app_label = 'app_goods'
~~~
